OCTAVE_INCLUDE = /opt/octave/octave/include/octave-3.8.0/octave/
MEX            = mkoctfile
INSTALL_DIR	= lib

CXX            = g++
F77            = gfortran
CFLAGS         = -O3 -fPIC -pthread -Wall -Werror -ansi -ffast-math -fomit-frame-pointer -fPIC
FFLAGS         = -O3 -fPIC -fexceptions -Wall -g -Wno-uninitialized 

#Choose the version of LBFGSB that you prefer
#LBFGSB_OBJS = solver.o
LBFGSB_OBJS = solver_3_0.o linpack.o timer.o blas.o 

###########################
# Do not edit from here on!
###########################

TARGET	= lbfgsb.mex

OBJS	= $(LBFGSB_OBJS) \
          matlabexception.o matlabscalar.o matlabstring.o   \
	  matlabmatrix.o arrayofmatrices.o program.o matlabprogram.o \
	  lbfgsb.o

all: $(TARGET)

%.o: %.cpp
	$(CXX) $(CFLAGS) -I$(OCTAVE_INCLUDE) -o $@ -c $^ -DOCTAVE

%.o: %.f
	$(F77) $(FFLAGS) -o $@ -c $^

$(TARGET): $(OBJS)
	$(MEX) --mex -o $@ $^

install: create-install-dir
	cp $(TARGET) ../$(INSTALL_DIR)
	cp *.m ../$(INSTALL_DIR)

create-install-dir:
	@if [ ! -e ../$(INSTALL_DIR) ]; then \
	mkdir ../$(INSTALL_DIR); \
	fi

clean:
	rm -f *.o $(TARGET)
	rm -f ../$(INSTALL_DIR) -R
